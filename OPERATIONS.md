# AI Chatbot - ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆãƒ»é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

## ğŸ“‹ ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³](#ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ](#ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ)
5. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
6. [ç’°å¢ƒå¤‰æ•°ç®¡ç†](#ç’°å¢ƒå¤‰æ•°ç®¡ç†)
7. [ç›£è¦–ã¨ãƒ­ã‚°](#ç›£è¦–ã¨ãƒ­ã‚°)
8. [é‹ç”¨æ‰‹é †](#é‹ç”¨æ‰‹é †)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
10. [ã‚³ã‚¹ãƒˆç®¡ç†](#ã‚³ã‚¹ãƒˆç®¡ç†)
11. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
12. [ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚«ãƒãƒª](#ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚«ãƒãƒª)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: AI Chatbot
- **ç›®çš„**: Anthropic Claudeã‚’åˆ©ç”¨ã—ãŸã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆå‘ã‘AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ
- **å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ä¸€èˆ¬å…¬é–‹ï¼ˆèªè¨¼ä¸è¦ï¼‰
- **æƒ³å®šè¦æ¨¡**: 5-10åã®åŒæ™‚æ¥ç¶š

### ä¸»è¦æ©Ÿèƒ½
- âœ… Claude AIã¨ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯¾è©±
- âœ… ä¼šè©±å±¥æ­´ã®æ°¸ç¶šåŒ–
- âœ… ä¼šè©±ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UIãƒ‡ã‚¶ã‚¤ãƒ³

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ãƒ¦ãƒ¼ã‚¶ãƒ¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTPS
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Google Cloud Run (asia-northeast1)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Next.js Application                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         Frontend (React)                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Chat Interface                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Message Display                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Input Form                                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         API Layer (Hono)                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - POST /api/chat                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - GET /api/messages                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - POST /api/reset                              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         Data Layer (Prisma)                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  è¨­å®š: min-instances=0, max-instances=2                      â”‚
â”‚  ãƒªã‚½ãƒ¼ã‚¹: 512Mi RAM, 1 CPU                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚
           â”‚                           â”‚ Secret Manager
           â”‚                           â†“
           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚              â”‚  Google Secret Manager   â”‚
           â”‚              â”‚  - DATABASE_URL          â”‚
           â”‚              â”‚  - ANTHROPIC_API_KEY     â”‚
           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MongoDB Atlas         â”‚         â”‚   Anthropic Claude API   â”‚
â”‚  - ä¼šè©±å±¥æ­´ä¿å­˜           â”‚         â”‚   - AIå¿œç­”ç”Ÿæˆ            â”‚
â”‚  - Message Collection    â”‚         â”‚   - Model: Sonnet 4.5    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GitHub Repository                         â”‚
â”‚                  furuboko/ai-chatbot                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ git push origin main
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GitHub Actions                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. Checkout code                                      â”‚  â”‚
â”‚  â”‚  2. Authenticate (Workload Identity Federation)       â”‚  â”‚
â”‚  â”‚  3. Build Docker image                                 â”‚  â”‚
â”‚  â”‚  4. Push to Google Container Registry                 â”‚  â”‚
â”‚  â”‚  5. Deploy to Cloud Run                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Google Container Registry (GCR)                      â”‚
â”‚          gcr.io/crypto-reality-367506/ai-chatbot             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloud Run Service                           â”‚
â”‚                   ai-chatbot                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| Next.js | 16.1.6 | Reactãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| React | 18+ | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| TypeScript | 5.x | å‹å®‰å…¨ãªé–‹ç™º |
| Tailwind CSS | 3.x | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| shadcn/ui | Latest | UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| Hono | 4.x | APIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| Prisma | 5.22.0 | ORM |
| Zod | 3.x | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| MongoDB | 7.x | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»DevOps
| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” |
|---------|------|
| Google Cloud Run | ã‚³ãƒ³ãƒ†ãƒŠãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° |
| Google Container Registry | Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| Google Secret Manager | æ©Ÿå¯†æƒ…å ±ç®¡ç† |
| MongoDB Atlas | ãƒãƒãƒ¼ã‚¸ãƒ‰MongoDB |
| GitHub Actions | CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ |
| Workload Identity Federation | èªè¨¼ |

### å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” |
|---------|------|
| Anthropic Claude API | AIå¿œç­”ç”Ÿæˆ |
| MongoDB Atlas | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° |

---

## ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

### Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID**: `crypto-reality-367506`
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç•ªå·**: `772986507207`
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `asia-northeast1` (æ±äº¬)

### Cloud Run ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š

```yaml
ã‚µãƒ¼ãƒ“ã‚¹å: ai-chatbot
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: asia-northeast1
ã‚¤ãƒ¡ãƒ¼ã‚¸: gcr.io/crypto-reality-367506/ai-chatbot:latest

ãƒªã‚½ãƒ¼ã‚¹:
  CPU: 1
  ãƒ¡ãƒ¢ãƒª: 512Mi

ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°:
  æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: 0
  æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: 2
  åŒæ™‚å®Ÿè¡Œæ•°: 80 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)

ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 300ç§’

èªè¨¼: æœªèªè¨¼ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯

ç’°å¢ƒå¤‰æ•°:
  - DATABASE_URL (Secret Managerå‚ç…§)
  - ANTHROPIC_API_KEY (Secret Managerå‚ç…§)
  - CLAUDE_MODEL: claude-3-5-sonnet-20241022
  - CLAUDE_MAX_TOKENS: 4096
  - CLAUDE_TEMPERATURE: 1.0
  - CONVERSATION_HISTORY_LIMIT: 50

ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:
  772986507207-compute@developer.gserviceaccount.com
```

### Container Registry
- **ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒªãƒã‚¸ãƒˆãƒª**: `gcr.io/crypto-reality-367506/ai-chatbot`
- **ã‚¿ã‚°ç®¡ç†**:
  - `latest`: æœ€æ–°ã®æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
  - `<commit-sha>`: å„ã‚³ãƒŸãƒƒãƒˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸

### Secret Manager
- **database-url**: MongoDBæ¥ç¶šæ–‡å­—åˆ—
- **anthropic-api-key**: Anthropic API ã‚­ãƒ¼

### IAMè¨­å®š

#### Service Accounts

**1. Cloud Runå®Ÿè¡Œç”¨**
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**: `772986507207-compute@developer.gserviceaccount.com`
- **ãƒ­ãƒ¼ãƒ«**:
  - Secret Manager Secret Accessor (Secretå‚ç…§ç”¨)

**2. GitHub Actionsç”¨**
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**: `github-actions-deploy@crypto-reality-367506.iam.gserviceaccount.com`
- **ãƒ­ãƒ¼ãƒ«**:
  - Cloud Run Admin (ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨)
  - Storage Admin (GCR pushç”¨)
  - Service Account User (Cloud Runå®Ÿè¡Œç”¨)
  - Artifact Registry Writer (ã‚¤ãƒ¡ãƒ¼ã‚¸pushç”¨)

#### Workload Identity Federation
- **Pool**: `github-actions-pool`
- **Provider**: `github-provider`
- **è¨±å¯ãƒªãƒã‚¸ãƒˆãƒª**: `furuboko/ai-chatbot`
- **èªè¨¼æ–¹å¼**: OIDC (OpenID Connect)

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 1. è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ (æ¨å¥¨)

GitHub Actionsã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

**ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶:**
- `main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®push
- æ‰‹å‹•å®Ÿè¡Œ (workflow_dispatch)

**ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼:**
```bash
# 1. ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "Update: æ–°æ©Ÿèƒ½è¿½åŠ "

# 2. GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
git push origin main

# 3. GitHub ActionsãŒè‡ªå‹•å®Ÿè¡Œ
# - Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ (ç´„1-2åˆ†)
# - GCRã¸ã®push (ç´„30ç§’)
# - Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤ (ç´„30ç§’)
# åˆè¨ˆ: ç´„2-3åˆ†
```

**é€²è¡ŒçŠ¶æ³ã®ç¢ºèª:**
```bash
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§ã‚’è¡¨ç¤º
gh run list --repo furuboko/ai-chatbot

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–
gh run watch <run-id> --repo furuboko/ai-chatbot

# ã¾ãŸã¯ GitHub Actionsãƒšãƒ¼ã‚¸ã§ç¢ºèª
https://github.com/furuboko/ai-chatbot/actions
```

### 2. æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤

ç·Šæ€¥æ™‚ã‚„ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆæ™‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

**æ‰‹é †:**

```bash
# 1. Google Cloudèªè¨¼
gcloud auth login
gcloud config set project crypto-reality-367506

# 2. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
gcloud builds submit --tag gcr.io/crypto-reality-367506/ai-chatbot

# 3. Cloud Runã«ãƒ‡ãƒ—ãƒ­ã‚¤
gcloud run deploy ai-chatbot \
  --image gcr.io/crypto-reality-367506/ai-chatbot:latest \
  --platform managed \
  --region asia-northeast1 \
  --allow-unauthenticated \
  --min-instances 0 \
  --max-instances 2 \
  --memory 512Mi \
  --cpu 1 \
  --timeout 300 \
  --set-secrets DATABASE_URL=database-url:latest,ANTHROPIC_API_KEY=anthropic-api-key:latest
```

### 3. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã€ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
# 1. åˆ©ç”¨å¯èƒ½ãªãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª
gcloud run revisions list \
  --service ai-chatbot \
  --region asia-northeast1

# 2. ç‰¹å®šã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã«ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆ
gcloud run services update-traffic ai-chatbot \
  --region asia-northeast1 \
  --to-revisions <revision-name>=100

# ä¾‹: ai-chatbot-00001-abc ã«100%ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’é€ã‚‹
gcloud run services update-traffic ai-chatbot \
  --region asia-northeast1 \
  --to-revisions ai-chatbot-00001-abc=100
```

### 4. ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§`npm run build`ãŒæˆåŠŸã™ã‚‹
- [ ] TypeScriptã®ã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒãŒæœ€æ–°
- [ ] ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒæœ€æ–°ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£ç¢ºèªï¼‰
- [ ] .envãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¦ã„ãªã„

---

## ç’°å¢ƒå¤‰æ•°ç®¡ç†

### Secret Managerè¨­å®š

**ç¾åœ¨ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ:**

```bash
# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä¸€è¦§è¡¨ç¤º
gcloud secrets list

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®è©³ç´°ç¢ºèª
gcloud secrets describe database-url
gcloud secrets describe anthropic-api-key
```

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®æ›´æ–°:**

```bash
# DATABASE_URLã®æ›´æ–°
echo -n "mongodb+srv://new-connection-string" | \
  gcloud secrets versions add database-url --data-file=-

# ANTHROPIC_API_KEYã®æ›´æ–°
echo -n "sk-ant-new-api-key" | \
  gcloud secrets versions add anthropic-api-key --data-file=-

# æ›´æ–°å¾Œã€Cloud Runã‚µãƒ¼ãƒ“ã‚¹ã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤
gcloud run services update ai-chatbot \
  --region asia-northeast1
```

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å‰Šé™¤ (æ³¨æ„):**

```bash
# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå…¨ä½“ã‚’å‰Šé™¤
gcloud secrets delete database-url

# ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿ç„¡åŠ¹åŒ–
gcloud secrets versions disable 1 --secret=database-url
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨:

```bash
# .env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp .env.example .env.local

# ä»¥ä¸‹ã‚’è¨­å®š
DATABASE_URL="mongodb+srv://..."
ANTHROPIC_API_KEY="sk-ant-..."
CLAUDE_MODEL="claude-3-5-sonnet-20241022"
CLAUDE_MAX_TOKENS=4096
CLAUDE_TEMPERATURE=1.0
CONVERSATION_HISTORY_LIMIT=50
```

**é‡è¦:** `.env.local`ã¯Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã“ã¨ï¼

---

## ç›£è¦–ã¨ãƒ­ã‚°

### Cloud Runãƒ­ã‚°ã®ç¢ºèª

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°:**
```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --limit 100 \
  --tail
```

**ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿è¡¨ç¤º:**
```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --log-filter 'severity>=ERROR'
```

**ç‰¹å®šæœŸé–“ã®ãƒ­ã‚°:**
```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --filter 'timestamp>="2026-02-18T00:00:00Z"'
```

### Cloud Console ã§ã®ç¢ºèª

**ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼:**
```
https://console.cloud.google.com/logs/query?project=crypto-reality-367506
```

ãƒ•ã‚£ãƒ«ã‚¿ä¾‹:
```
resource.type="cloud_run_revision"
resource.labels.service_name="ai-chatbot"
severity>=ERROR
```

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–

**Cloud Runãƒ¡ãƒˆãƒªã‚¯ã‚¹:**
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
- ã‚¨ãƒ©ãƒ¼ç‡
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°
- CPUä½¿ç”¨ç‡
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡

**ç¢ºèªæ–¹æ³•:**
```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°ã‚’ç¢ºèª
gcloud run services describe ai-chatbot \
  --region asia-northeast1 \
  --format json

# Cloud Consoleã§ç¢ºèª
https://console.cloud.google.com/run/detail/asia-northeast1/ai-chatbot/metrics?project=crypto-reality-367506
```

### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š (æ¨å¥¨)

Cloud Monitoringã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®š:

```yaml
ã‚¢ãƒ©ãƒ¼ãƒˆä¾‹:
  - ã‚¨ãƒ©ãƒ¼ç‡ãŒ5%ã‚’è¶…ãˆãŸå ´åˆ
  - ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒ3ç§’ã‚’è¶…ãˆãŸå ´åˆ
  - ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ãŒä¸Šé™ã«é”ã—ãŸå ´åˆ
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒæ€¥å¢—ã—ãŸå ´åˆ
```

è¨­å®šæ–¹æ³•:
```
Cloud Console > Monitoring > Alerting > Create Policy
```

---

## é‹ç”¨æ‰‹é †

### æ—¥å¸¸é‹ç”¨

**æ¯æ—¥:**
- [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œç¢ºèªï¼ˆURLç–é€šãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª

**æ¯é€±:**
- [ ] Cloud Runãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ç¢ºèª
- [ ] ã‚³ã‚¹ãƒˆçŠ¶æ³ã®ç¢ºèª
- [ ] ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç¢ºèª

**æ¯æœˆ:**
- [ ] MongoDB Atlasã®å®¹é‡ç¢ºèª
- [ ] APIåˆ©ç”¨é‡ã®ç¢ºèªï¼ˆAnthropicï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‹•ä½œç¢ºèª

### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½œæ¥­

**ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°:**

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ãƒã‚§ãƒƒã‚¯
npm audit

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°
npm update

# ã¾ãŸã¯ç‰¹å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ›´æ–°
npm update next react react-dom

# ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
npm run build

# å•é¡Œãªã‘ã‚Œã°ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
git add package.json package-lock.json
git commit -m "chore: Update dependencies"
git push origin main
```

**Prismaã‚¹ã‚­ãƒ¼ãƒã®å¤‰æ›´:**

```bash
# ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´å¾Œ
npx prisma generate
npx prisma db push

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆæœ¬ç•ªæ¨å¥¨ï¼‰
npx prisma migrate dev --name add_new_field

# æœ¬ç•ªç’°å¢ƒã«é©ç”¨
npx prisma migrate deploy
```

### ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—/ãƒ€ã‚¦ãƒ³

**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ã®èª¿æ•´:**

```bash
# æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ã‚’å¢—ã‚„ã™
gcloud run services update ai-chatbot \
  --region asia-northeast1 \
  --max-instances 5

# æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¨­å®šï¼ˆå¸¸æ™‚èµ·å‹•ï¼‰
gcloud run services update ai-chatbot \
  --region asia-northeast1 \
  --min-instances 1
```

**ãƒªã‚½ãƒ¼ã‚¹ã®èª¿æ•´:**

```bash
# ãƒ¡ãƒ¢ãƒªã¨CPUã®å¢—å¼·
gcloud run services update ai-chatbot \
  --region asia-northeast1 \
  --memory 1Gi \
  --cpu 2
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

**MongoDB Atlasã§ã®ä½œæ¥­:**

```bash
# ä¼šè©±å±¥æ­´ã®ä»¶æ•°ç¢ºèª
# MongoDB Atlasã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¾ãŸã¯ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç¢ºèª
```

**å¤ã„ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ (å¿…è¦ã«å¿œã˜ã¦):**

```javascript
// MongoDB Shellã¾ãŸã¯Compass
db.messages.deleteMany({
  createdAt: { $lt: new Date('2026-01-01') }
})
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**ç¢ºèªæ‰‹é †:**

1. **ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª**
```bash
gcloud run services describe ai-chatbot \
  --region asia-northeast1 \
  --format='value(status.conditions.status)'
```

2. **æœ€æ–°ã®ãƒ­ã‚°ã‚’ç¢ºèª**
```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --limit 50
```

3. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ãƒ•ã‚£ãƒ«ã‚¿**
```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --log-filter 'severity>=ERROR' \
  --limit 20
```

**ã‚ˆãã‚ã‚‹åŸå› :**
- Secret Managerã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
- MongoDBã¸ã®æ¥ç¶šãŒå¤±æ•—ã—ã¦ã„ã‚‹
- Anthropic APIã‚­ãƒ¼ãŒç„¡åŠ¹

### å•é¡Œ: ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã™ã‚‹

**GitHub Actions ã®ãƒ­ã‚°ã‚’ç¢ºèª:**

```bash
gh run list --repo furuboko/ai-chatbot --limit 1
gh run view <run-id> --log-failed --repo furuboko/ai-chatbot
```

**ã‚ˆãã‚ã‚‹åŸå› :**
- Dockerãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼ˆä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å•é¡Œï¼‰
- æ¨©é™ã‚¨ãƒ©ãƒ¼ï¼ˆIAMãƒ­ãƒ¼ãƒ«ã®ä¸è¶³ï¼‰
- Secret Managerã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®å•é¡Œ
- ãƒ“ãƒ«ãƒ‰æ™‚ã®ç’°å¢ƒå¤‰æ•°ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•:**

```bash
# æ¨©é™ã®å†ç¢ºèª
gcloud projects get-iam-policy crypto-reality-367506 \
  --flatten="bindings[].members" \
  --filter="bindings.members:github-actions-deploy@*"

# Secret Managerã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’å†ä»˜ä¸
gcloud secrets add-iam-policy-binding database-url \
  --member="serviceAccount:772986507207-compute@developer.gserviceaccount.com" \
  --role="roles/secretmanager.secretAccessor"
```

### å•é¡Œ: Claude APIã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèª:**

```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --log-filter 'textPayload=~"anthropic"'
```

**ã‚ˆãã‚ã‚‹åŸå› :**
- APIã‚­ãƒ¼ã®æœŸé™åˆ‡ã‚Œ
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é
- APIã‚¯ãƒ¬ã‚¸ãƒƒãƒˆä¸è¶³

**è§£æ±ºæ–¹æ³•:**

1. Anthropicã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª: https://console.anthropic.com/
2. APIã‚­ãƒ¼ã‚’å†ç”Ÿæˆã—ã¦æ›´æ–°
```bash
echo -n "sk-ant-new-api-key" | \
  gcloud secrets versions add anthropic-api-key --data-file=-
```

### å•é¡Œ: MongoDBã«æ¥ç¶šã§ããªã„

**æ¥ç¶šæ–‡å­—åˆ—ã®ç¢ºèª:**

```bash
# Secret Managerã®å€¤ã‚’ç¢ºèªï¼ˆæ¨©é™ãŒå¿…è¦ï¼‰
gcloud secrets versions access latest --secret=database-url
```

**ã‚ˆãã‚ã‚‹åŸå› :**
- MongoDB Atlasã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š
- IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã®å•é¡Œ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®åœæ­¢

**è§£æ±ºæ–¹æ³•:**

1. MongoDB Atlasã§ç¢ºèª:
   - Network Accessè¨­å®šã‚’ç¢ºèª
   - Database Accessã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã‚’ç¢ºèª
   - ClusterãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª

2. æ¥ç¶šæ–‡å­—åˆ—ã‚’æ›´æ–°
```bash
echo -n "æ–°ã—ã„æ¥ç¶šæ–‡å­—åˆ—" | \
  gcloud secrets versions add database-url --data-file=-
```

### å•é¡Œ: ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

**ãƒ­ã‚°ã§ç¢ºèª:**

```bash
gcloud run logs read \
  --service ai-chatbot \
  --region asia-northeast1 \
  --log-filter 'textPayload=~"memory"'
```

**è§£æ±ºæ–¹æ³•:**

```bash
# ãƒ¡ãƒ¢ãƒªã‚’å¢—ã‚„ã™
gcloud run services update ai-chatbot \
  --region asia-northeast1 \
  --memory 1Gi
```

### ç·Šæ€¥å¯¾å¿œãƒ•ãƒ­ãƒ¼

**ã‚µãƒ¼ãƒ“ã‚¹ãŒå®Œå…¨ã«ãƒ€ã‚¦ãƒ³ã—ãŸå ´åˆ:**

```bash
# 1. æœ€æ–°ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
gcloud run logs read --service ai-chatbot --region asia-northeast1 --limit 100

# 2. ä»¥å‰ã®æ­£å¸¸å‹•ä½œã—ã¦ã„ãŸãƒªãƒ“ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
gcloud run revisions list --service ai-chatbot --region asia-northeast1
gcloud run services update-traffic ai-chatbot \
  --region asia-northeast1 \
  --to-revisions <previous-revision>=100

# 3. å•é¡Œã®èª¿æŸ»ã¨ä¿®æ­£

# 4. ä¿®æ­£ç‰ˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
git push origin main
```

---

## ã‚³ã‚¹ãƒˆç®¡ç†

### æœˆé¡ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆ5-10ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ³å®šï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | ä½¿ç”¨é‡ | æœˆé¡ï¼ˆæ¦‚ç®—ï¼‰ |
|---------|-------|------------|
| **Cloud Run** | | |
| - CPUæ™‚é–“ | 10-20 vCPUæ™‚é–“/æœˆ | Â¥70-140 |
| - ãƒ¡ãƒ¢ãƒª | 10-20 GiBæ™‚é–“/æœˆ | Â¥15-30 |
| - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | 10,000-50,000/æœˆ | Â¥0-5 |
| **Container Registry** | | |
| - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | ~5GB | Â¥50 |
| - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | ~1GB/æœˆ | Â¥10 |
| **Secret Manager** | | |
| - ã‚¢ã‚¯ã‚»ã‚¹ | ~10,000å›/æœˆ | Â¥3 |
| **MongoDB Atlas** | | |
| - M0 Free Tier | 512MB | Â¥0 |
| **Anthropic Claude API** | | |
| - 50,000ãƒˆãƒ¼ã‚¯ãƒ³/æ—¥ | ç´„1.5M ãƒˆãƒ¼ã‚¯ãƒ³/æœˆ | Â¥1,500-3,000 |
| **åˆè¨ˆ** | | **Â¥1,650-3,250/æœˆ** |

### ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ

**1. Cloud Runã®æœ€é©åŒ–:**
- æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹0ã«è¨­å®šï¼ˆã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆè¨±å®¹ï¼‰
- å¿…è¦æœ€å°é™ã®ãƒ¡ãƒ¢ãƒªè¨­å®šï¼ˆ512Miï¼‰
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’é©åˆ‡ã«è¨­å®šï¼ˆ300ç§’ï¼‰

**2. MongoDB Atlasã®æœ€é©åŒ–:**
- Free Tierï¼ˆM0ï¼‰ã‚’æ´»ç”¨
- å¤ã„ä¼šè©±å±¥æ­´ã®å®šæœŸå‰Šé™¤
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–

**3. Claude APIã®æœ€é©åŒ–:**
- ä¼šè©±å±¥æ­´ã®åˆ¶é™ï¼ˆ50ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã®åˆ¶é™ï¼ˆ4096ï¼‰
- ä¸è¦ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å‰Šæ¸›

### ã‚³ã‚¹ãƒˆç›£è¦–

**Cloud Billingãƒ¬ãƒãƒ¼ãƒˆ:**
```
https://console.cloud.google.com/billing/reports?project=crypto-reality-367506
```

**äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š:**

```bash
# äºˆç®—è¨­å®šï¼ˆCloud Consoleæ¨å¥¨ï¼‰
# Billing > Budgets & alerts
# ä¾‹: æœˆé¡5,000å††ã§ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
```

**æ—¥æ¬¡ã‚³ã‚¹ãƒˆã®ç¢ºèª:**

```bash
# BigQueryã§ã‚³ã‚¹ãƒˆã‚¯ã‚¨ãƒªï¼ˆè¦è¨­å®šï¼‰
# ã¾ãŸã¯ Cloud Console Billingãƒšãƒ¼ã‚¸ã§ç¢ºèª
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

**1. èªè¨¼ãƒ»èªå¯**
- âœ… Workload Identity Federationï¼ˆGitHub Actionsï¼‰
- âœ… Service Accountæœ€å°æ¨©é™ã®åŸå‰‡
- âœ… Secret Managerã§ã®æ©Ÿå¯†æƒ…å ±ç®¡ç†

**2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
- âœ… HTTPSå¼·åˆ¶ï¼ˆCloud Runè‡ªå‹•ï¼‰
- âœ… CORSè¨­å®š
- âœ… Rate Limitingå®Ÿè£…

**3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
- âœ… å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰
- âœ… SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆPrisma ORMï¼‰
- âœ… XSSå¯¾ç­–ï¼ˆReactã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
- âœ… ç’°å¢ƒå¤‰æ•°ã®æš—å·åŒ–ä¿å­˜

**4. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**
- âœ… npm auditå®šæœŸå®Ÿè¡Œ
- âœ… Dependabotæœ‰åŠ¹åŒ–æ¨å¥¨

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

**å®šæœŸç¢ºèªé …ç›®:**

- [ ] ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆé€±æ¬¡ï¼‰
```bash
npm audit
npm audit fix
```

- [ ] APIã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå››åŠæœŸï¼‰
```bash
# Anthropic APIã‚­ãƒ¼ã‚’å†ç”Ÿæˆ
# Secret Managerã§æ›´æ–°
```

- [ ] IAMæ¨©é™ã®è¦‹ç›´ã—ï¼ˆå››åŠæœŸï¼‰
```bash
gcloud projects get-iam-policy crypto-reality-367506
```

- [ ] ãƒ­ã‚°ã®ç•°å¸¸æ¤œçŸ¥ï¼ˆé€±æ¬¡ï¼‰
```bash
# ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª
gcloud run logs read --service ai-chatbot --region asia-northeast1 \
  --log-filter 'severity>=WARNING'
```

### ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

**ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œçŸ¥ã—ãŸå ´åˆ:**

1. **å³åº§ã®å¯¾å¿œ:**
```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¸€æ™‚åœæ­¢
gcloud run services update ai-chatbot \
  --region asia-northeast1 \
  --no-allow-unauthenticated

# ã¾ãŸã¯å®Œå…¨åœæ­¢
gcloud run services delete ai-chatbot --region asia-northeast1
```

2. **ãƒ­ã‚°ã®ä¿å­˜:**
```bash
# ã™ã¹ã¦ã®ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
gcloud logging read "resource.type=cloud_run_revision" \
  --limit 10000 \
  --format json > incident-logs-$(date +%Y%m%d).json
```

3. **APIã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³:**
```bash
# Anthropic APIã‚­ãƒ¼ã‚’å³åº§ã«ç„¡åŠ¹åŒ–ï¼†å†ç”Ÿæˆ
# MongoDBæ¥ç¶šæ–‡å­—åˆ—ã®å¤‰æ›´
```

4. **åŸå› èª¿æŸ»ã¨å†ç™ºé˜²æ­¢ç­–ã®å®Ÿæ–½**

---

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚«ãƒãƒª

### ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

**MongoDB Atlasï¼ˆè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰:**
- Free Tierã§ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½åˆ¶é™ã‚ã‚Š
- æœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼ˆM10+ï¼‰ã§è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æœ‰åŠ¹

**æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰:**

```bash
# mongodumpã‚’ä½¿ç”¨ã—ãŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
mongodump --uri="mongodb+srv://..." --out=backup-$(date +%Y%m%d)

# ã¾ãŸã¯ MongoDB Compassã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
# Collections > messages > Export Data
```

**å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**

```bash
#!/bin/bash
# backup.sh
DATE=$(date +%Y%m%d-%H%M%S)
BACKUP_DIR="backups/${DATE}"

# MongoDB export
mongodump --uri="${DATABASE_URL}" --out="${BACKUP_DIR}"

# Google Cloud Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
tar -czf "${BACKUP_DIR}.tar.gz" "${BACKUP_DIR}"
gsutil cp "${BACKUP_DIR}.tar.gz" gs://your-backup-bucket/

echo "Backup completed: ${BACKUP_DIR}"
```

### ãƒªã‚«ãƒãƒªæ‰‹é †

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¾©å…ƒ:**

```bash
# mongorestore ã‚’ä½¿ç”¨
mongorestore --uri="mongodb+srv://..." --dir=backup-20260218/

# ç‰¹å®šã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿å¾©å…ƒ
mongorestore --uri="mongodb+srv://..." --dir=backup-20260218/ \
  --nsInclude="chatbot.messages"
```

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¾©å…ƒ:**

```bash
# ä»¥å‰ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
gcloud run deploy ai-chatbot \
  --image gcr.io/crypto-reality-367506/ai-chatbot:<commit-sha> \
  --region asia-northeast1
```

### ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒªã‚«ãƒãƒªè¨ˆç”»

**RTO (Recovery Time Objective): 1æ™‚é–“**
**RPO (Recovery Point Objective): 24æ™‚é–“**

**æ‰‹é †:**

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©å…ƒ** (15åˆ†)
   - æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰MongoDBå¾©å…ƒ

2. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¾©å…ƒ** (15åˆ†)
   - æ­£å¸¸å‹•ä½œã—ã¦ã„ãŸDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

3. **å‹•ä½œç¢ºèª** (15åˆ†)
   - ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
   - ãƒ­ã‚°ç¢ºèª

4. **ã‚µãƒ¼ãƒ“ã‚¹å†é–‹** (15åˆ†)
   - DNSã®ç¢ºèª
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥

---

## ä»˜éŒ²

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰é›†

```bash
# === Cloud Run ===
# ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§
gcloud run services list --region asia-northeast1

# ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°
gcloud run services describe ai-chatbot --region asia-northeast1

# ãƒ­ã‚°è¡¨ç¤ºï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
gcloud run logs tail --service ai-chatbot --region asia-northeast1

# ãƒªãƒ“ã‚¸ãƒ§ãƒ³ä¸€è¦§
gcloud run revisions list --service ai-chatbot --region asia-northeast1

# === GitHub Actions ===
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¸€è¦§
gh run list --repo furuboko/ai-chatbot

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç›£è¦–
gh run watch <run-id> --repo furuboko/ai-chatbot

# æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
gh workflow run deploy.yml --repo furuboko/ai-chatbot

# === Secret Manager ===
# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä¸€è¦§
gcloud secrets list

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å€¤ã‚’è¡¨ç¤º
gcloud secrets versions access latest --secret=database-url

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ›´æ–°
echo -n "new-value" | gcloud secrets versions add secret-name --data-file=-

# === Container Registry ===
# ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸€è¦§
gcloud container images list --repository=gcr.io/crypto-reality-367506

# ã‚¿ã‚°ä¸€è¦§
gcloud container images list-tags gcr.io/crypto-reality-367506/ai-chatbot
```

### ãƒªãƒ³ã‚¯é›†

**Google Cloud:**
- [Cloud Runã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.cloud.google.com/run?project=crypto-reality-367506)
- [Cloud Logsã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼](https://console.cloud.google.com/logs?project=crypto-reality-367506)
- [Secret Manager](https://console.cloud.google.com/security/secret-manager?project=crypto-reality-367506)
- [Billing](https://console.cloud.google.com/billing?project=crypto-reality-367506)
- [IAM](https://console.cloud.google.com/iam-admin?project=crypto-reality-367506)

**GitHub:**
- [ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/furuboko/ai-chatbot)
- [GitHub Actions](https://github.com/furuboko/ai-chatbot/actions)
- [Secretsè¨­å®š](https://github.com/furuboko/ai-chatbot/settings/secrets/actions)

**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹:**
- [MongoDB Atlas](https://cloud.mongodb.com/)
- [Anthropic Console](https://console.anthropic.com/)

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
- [Cloud Run ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/run/docs)
- [Next.js ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nextjs.org/docs)
- [Prisma ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.prisma.io/docs)
- [Claude API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.anthropic.com/)

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | æ‹…å½“è€… |
|------|-----------|---------|--------|
| 2026-02-18 | 1.0.0 | åˆç‰ˆä½œæˆ | Claude Code |

---

**æœ€çµ‚æ›´æ–°**: 2026-02-18
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ªãƒ¼ãƒŠãƒ¼**: Development Team
**ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ã‚¯ãƒ«**: å››åŠæœŸã”ã¨
